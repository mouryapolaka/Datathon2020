<!DOCTYPE html>
<html>
    <head>
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
        <!-- Google Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
        <!-- Bootstrap core CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
        <!-- Material Design Bootstrap -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
        <!-- JQuery -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- Bootstrap tooltips -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
        <!-- MDB core JavaScript -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Multilpe Select</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    </head>
    <style>
        .mul-select{
            width: 100%;
        }
    </style>
    <script>
        $(document).ready(function(){
            $(".mul-select").select2({
                    placeholder: "select skills",
                    tags: true,
                    tokenSeparators: ['/',',',';'," "] 
                });
            })
    </script>

    <iframe name="hiddenFrame" width="0" height="0" style="display: none;"></iframe>
    <div class="row justify-content-center align-items-center h-100">
        <div class="col col-sm-6 col-md-6 col-lg-4 col-xl-3">
            <div class="form-group">
                <form id="myForm" name="myForm" target="hiddenFrame">
                    <select class="mul-select" id="skills" name="skills" multiple="true">
                        <option value="PYTHON">PYTHON</option>
                        <option value="JAVA">JAVA</option>
                        <option value="TENSORFLOW">TENSORFLOW</option>
                    </select>
                    <input id = "update" type="submit" value="Submit">
            </form> 
        </div> 
   </div>
</div>
    
    <canvas id="myChart" style="max-width: 750px;" ></canvas>

    <br><br>
    <form id="role_skill_form" name="role_skill_form" target="hiddenFrame">
        <input type="text" id = "role" name="role">
        <input id = "update_role_skill" type="submit" value="Submit">
    </form>

    <canvas id="role_skills_chart" style="max-width: 1000px;" ></canvas>

    <br><br>
    <form id="location_form" name="location_form" target="hiddenFrame">
        <input type="text" id = "location" name="location">
        <input id = "update_location_jobmarket" type="submit" value="Submit">
    </form>
    <canvas id="location_category_chart" style="max-width: 1000px;" ></canvas>

    <br><br>

    <form id="jobtype_form" name="jobtype_form" target="hiddenFrame">
        <label>Location</label>
        <input type="text" id = "location" name="location"><br>
        <label>Category</label>
        <input type="text" id = "category" name="category"><br>
        <input id = "update_jobtype" type="submit" value="Submit">
    </form>

    <canvas id="jobtype_chart" style="max-width: 750px;" ></canvas>

    <!-- Script for myChart-->
    <script>
        var myChart;
        var ctx = document.getElementById("myChart").getContext('2d');
        //get json data from get_json()
        var getData = $.get('/get_skill_recommendations');

        getData.done(function(results){
            myChart = new Chart(ctx, {
            type: 'horizontalBar',
            data: {
                labels: results.labels,
                datasets: [{
                    data: results.data,
                    backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)'],
                    borderColor: ['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Top 10 recommended skills based on your current skill set'},
                scales: {xAxes: [{ ticks: {max: 1, min: 0}}]}
            }});
        })

        function updateSkillsChart(){
            $.ajax({
                type: "POST",
                url: "/get_skill_recommendations",
                data: $("#myForm").serialize(),
                success: function(data)
                {
                    myChart.data.labels = data.labels;
                    myChart.data.datasets[0].data = data.data;
                    myChart.update();
                }
            });
        };

        $('#update').on('click', updateSkillsChart);

    </script>

    <!-- Script for role_skills_chart -->
    <script>
        var myChart1;
        var ctx1 = document.getElementById("role_skills_chart").getContext('2d');
        //get json data from get_json()
        var getData = $.get('/role_skills');

        getData.done(function(results){
            myChart1 = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: results.skills,
                datasets: [{
                    data: results.ratings,
                    label: results.role,
                    backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)','rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)'],
                    borderColor: ['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)','rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Recommended skills based on role'},
                scales: {yAxes: [{ ticks: {max: 5, min: 0}}],
                        xAxes: [{ticks: {autoSkip: false}}]}}});
        })

        function update_role_skills_chart(){
            $.ajax({
                type: "POST",
                url: "/role_skills",
                data: $("#role_skill_form").serialize(),
                success: function(data)
                {
                    myChart1.data.datasets[0].label = data.role;
                    myChart1.data.labels = data.skills;
                    myChart1.data.datasets[0].data = data.ratings;
                    myChart1.update();
                }
            });
        };

        $('#update_role_skill').on('click', update_role_skills_chart);
    </script>


<script>
        var myChart1;
        var ctx1 = document.getElementById("role_skills_chart").getContext('2d');
        //get json data from get_json()
        var getData = $.get('/role_skills');

        getData.done(function(results){
            myChart1 = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: results.skills,
                datasets: [{
                    data: results.ratings,
                    label: results.role,
                    backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)','rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)'],
                    borderColor: ['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)','rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Recommended skills based on role'},
                scales: {yAxes: [{ ticks: {max: 5, min: 0}}],
                        xAxes: [{ticks: {autoSkip: false}}]}}});
        })

        function update_role_skills_chart(){
            $.ajax({
                type: "POST",
                url: "/role_skills",
                data: $("#role_skill_form").serialize(),
                success: function(data)
                {
                    myChart1.data.datasets[0].label = data.role;
                    myChart1.data.labels = data.skills;
                    myChart1.data.datasets[0].data = data.ratings;
                    myChart1.update();
                }
            });
        };

        $('#update_role_skill').on('click', update_role_skills_chart);
    </script>



    <script>
        var myChart2;
        var ctx2 = document.getElementById("location_category_chart").getContext('2d');
        //get json data from get_json()
        var getData = $.get('/location_category');

        getData.done(function(results){
            myChart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: results.categories,
                datasets: [{
                    data: results.frequency,
                    label: results.location,
                    backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)','rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)'],
                    borderColor: ['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)','rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Job Markets based on location'},
                scales: {xAxes: [{ticks: {autoSkip: false}}]}}});
        })

        function update_location_jobmarket(){
            $.ajax({
                type: "POST",
                url: "/location_category",
                data: $("#location_form").serialize(),
                success: function(data)
                {
                    myChart2.data.datasets[0].label = data.location;
                    myChart2.data.labels = data.categories;
                    myChart2.data.datasets[0].data = data.frequency;
                    myChart2.update();
                }
            });
        };

        $('#update_location_jobmarket').on('click', update_location_jobmarket);
    </script>



<script>
        var myChart2;
        var ctx2 = document.getElementById("location_category_chart").getContext('2d');
        //get json data from get_json()
        var getData = $.get('/location_category');

        getData.done(function(results){
            myChart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: results.categories,
                datasets: [{
                    data: results.frequency,
                    label: results.location,
                    backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)','rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(153, 102, 255, 0.5)',
                        'rgba(0, 0, 255, 0.5)', 'rgba(0, 51, 102, 0.5)', 'rgba(255, 128, 0, 0.5)', 'rgba(255, 102, 178, 0.5)', 'rgba(178, 255, 102, 0.5)'],
                    borderColor: ['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)','rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)',
                        'rgba(0, 0, 255, 1)','rgba(0, 51, 102, 1)','rgba(255, 128, 0, 1)','rgba(255, 102, 178, 1)','rgba(178, 255, 102, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Job Markets based on location'},
                scales: {xAxes: [{ticks: {autoSkip: false}}]}}});
        })

        function update_location_jobmarket(){
            $.ajax({
                type: "POST",
                url: "/location_category",
                data: $("#location_form").serialize(),
                success: function(data)
                {
                    myChart2.data.datasets[0].label = data.location;
                    myChart2.data.labels = data.categories;
                    myChart2.data.datasets[0].data = data.frequency;
                    myChart2.update();
                }
            });
        };

        $('#update_location_jobmarket').on('click', update_location_jobmarket);
    </script>

<script>
    var myChart3;
    
    var ctx3 = document.getElementById("jobtype_chart").getContext('2d');

    var getData = $.get('/job_type');

    getData.done(function(results){
        myChart3 = new Chart(ctx3, {
        plugins: [ChartDataLabels],
        type: 'pie',
        data: {
            labels: results.job_type,
            datasets: [{
            data: results.frequency,
            backgroundColor: ["#F7464A", "#46BFBD", "#FDB45C", "#949FB1"],
            hoverBackgroundColor: ["#FF5A5E", "#5AD3D1", "#FFC870", "#A8B3C5"]
            }]
        },
        options: {
            responsive: true,
            legend: {
            position: 'right',
            labels: {
                padding: 20,
                boxWidth: 10
            }
            },
            plugins: {
            datalabels: {
                formatter: (value, ctx3) => {
                let sum = 0;
                let dataArr = ctx3.chart.data.datasets[0].data;
                dataArr.map(data => {
                    sum += data;
                });
                let percentage = (value * 100 / sum).toFixed(2) + "%";
                return percentage;
                },
                color: 'white',
                labels: {
                title: {
                    font: {
                    size: '16'
                    }
                }
                }
            }
            }
        }
        });
    })

    function update_jobtype(){
        $.ajax({
            type: "POST",
            url: "/job_type",
            data: $("#jobtype_form").serialize(),
            success: function(data)
            {
                myChart3.data.labels = data.job_type;
                myChart3.data.datasets[0].data = data.frequency;
                myChart3.update();
            }
        });
    };

    $('#update_jobtype').on('click', update_jobtype);

</script>
    </body>
</html>